{"version":3,"file":"commonHelpers.js","sources":["../src/js/api.js","../src/js/izitoast.js","../src/js/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_URL = 'https://pixabay.com/api/';\nconst KEY = '44145043-d94906ce2cc1245071fea5b6f';\n\nexport async function searchImages(query, page = 1, limit = 30) {\n  const response = await axios.get(\n    `${API_URL}/?key=${KEY}&q=${query}&image_type=photo&orientation=horizontal&safesearch=true&per_page=${limit}&page=${page}`\n  );\n\n  const hits = response.data.hits.map(\n    ({\n      webformatURL,\n      largeImageURL,\n      tags,\n      likes,\n      views,\n      comments,\n      downloads,\n    }) => ({\n      webformatURL,\n      largeImageURL,\n      tags,\n      likes,\n      views,\n      comments,\n      downloads,\n    })\n  );\n\n  return {\n    hits,\n    total: response.data.totalHits,\n  };\n}\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nexport function displayMessage(\n  message,\n  color,\n  position = 'topRight',\n  timeout = 5000\n) {\n  iziToast.show({\n    message,\n    color,\n    position,\n    timeout,\n  });\n}\n\nexport function displayError(message) {\n  displayMessage(message, 'red');\n}\n\nexport function displayInfo(message) {\n  displayMessage(message, 'green');\n}\n","import debounce from 'lodash.debounce';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport { searchImages } from './api.js';\nimport { displayError, displayInfo } from './izitoast.js';\n\nconst IMAGES_PER_PAGE = 30;\nlet lightBox;\n\nfunction bindFormEvents() {\n  const form = document.getElementById('search-form');\n\n  if (!form) {\n    return;\n  }\n\n  form.addEventListener('submit', async event => {\n    event.preventDefault();\n\n    const searchQueryElement = [...form.elements].find(\n      element => element.name === 'searchQuery'\n    );\n\n    if (!searchQueryElement) {\n      return;\n    }\n\n    const searchQuery = searchQueryElement.value;\n    await loadImages(searchQuery, 1, true);\n  });\n}\n\nfunction storeFormData({ query, page, total }) {\n  localStorage.setItem('query', query);\n  localStorage.setItem('page', page);\n  localStorage.setItem('total', total);\n}\n\nfunction getFormData() {\n  const query = localStorage.getItem('query');\n  const page = +localStorage.getItem('page');\n  const total = +localStorage.getItem('total');\n\n  return {\n    query,\n    page,\n    total,\n  };\n}\n\nfunction bindScrollEvents() {\n  window.addEventListener(\n    'scroll',\n    debounce(async () => {\n      const { scrollTop, scrollHeight, clientHeight } =\n        document.documentElement;\n\n      if (scrollTop + clientHeight >= scrollHeight && hasMoreImages()) {\n        const { query, page } = getFormData();\n\n        await loadImages(query, page + 1);\n      }\n    }, 400),\n    {\n      passive: true,\n    }\n  );\n}\n\nasync function loadImages(query, page, replaceCards = false) {\n  if (!query?.trim()) {\n    clearGallery();\n    displayError('Query should not be empty.');\n    return;\n  }\n\n  try {\n    displayLoader();\n\n    const images = await searchImages(query, page, IMAGES_PER_PAGE);\n\n    storeFormData({ query, page, total: images.total });\n    renderCards(images.hits, replaceCards);\n\n    if (replaceCards) {\n      if (!images.total) {\n        displayError(\n          'Sorry, there are no images matching your search query. Please try again.'\n        );\n      } else {\n        displayInfo(`Hooray! We found ${images.total} images.`);\n      }\n    }\n\n    if (!hasMoreImages() && images.total) {\n      displayError(\n        \"We're sorry, but you've reached the end of search results.\"\n      );\n    }\n  } catch (e) {\n    clearGallery();\n    displayError('Sorry, error occurred. Please try again.');\n  } finally {\n    displayLoader(false);\n  }\n}\n\nfunction clearGallery() {\n  renderCards([], true);\n}\n\nfunction hasMoreImages() {\n  const { page, total } = getFormData();\n\n  return total > page * IMAGES_PER_PAGE;\n}\n\nfunction bindEvents() {\n  bindFormEvents();\n  bindScrollEvents();\n  lightBox = createSimpleLightBox();\n}\n\nfunction createCard(item) {\n  const {\n    webformatURL,\n    largeImageURL,\n    tags,\n    likes,\n    views,\n    comments,\n    downloads,\n  } = item;\n  return `\n  <div class=\"photo-card\">\n    <div class=\"image-container\">\n      <a href=\"${largeImageURL}\">\n        <img src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\n      </a>\n    </div>\n    <div class=\"info\">\n        <p class=\"info-item\">\n          <b>Likes</b>\n          <span>${likes}</span>\n        </p>\n        <p class=\"info-item\">\n          <b>Views</b>\n          <span>${views}</span>\n        </p>\n        <p class=\"info-item\">\n            <b>Comments</b>\n            <span>${comments}</span>\n        </p>\n        <p class=\"info-item\">\n            <b>Downloads</b>\n            <span>${downloads}</span>\n        </p>\n    </div>\n   </div>\n  `;\n}\n\nfunction renderCards(items, replace = true) {\n  const galleryElement = document.querySelector('.gallery');\n\n  if (!galleryElement) {\n    return;\n  }\n\n  const cardsHtml = items.map(item => createCard(item)).join('');\n\n  if (replace) {\n    galleryElement.innerHTML = cardsHtml;\n  } else {\n    galleryElement.insertAdjacentHTML('beforeend', cardsHtml);\n  }\n\n  lightBox?.refresh();\n}\n\nfunction displayLoader(visible = true) {\n  const loader = document.querySelector('.loader');\n\n  if (!loader) {\n    return;\n  }\n\n  if (visible) {\n    loader.classList.remove('hidden');\n  } else {\n    loader.classList.add('hidden');\n  }\n}\n\nfunction createSimpleLightBox() {\n  return new SimpleLightbox('.gallery a', {\n    captionDelay: 250,\n    captionsData: 'alt',\n  });\n}\n\nbindEvents();\n"],"names":["API_URL","KEY","searchImages","query","page","limit","response","axios","webformatURL","largeImageURL","tags","likes","views","comments","downloads","displayMessage","message","color","position","timeout","iziToast","displayError","displayInfo","IMAGES_PER_PAGE","lightBox","bindFormEvents","form","event","searchQueryElement","element","searchQuery","loadImages","storeFormData","total","getFormData","bindScrollEvents","debounce","scrollTop","scrollHeight","clientHeight","hasMoreImages","replaceCards","clearGallery","displayLoader","images","renderCards","bindEvents","createSimpleLightBox","createCard","item","items","replace","galleryElement","cardsHtml","visible","loader","SimpleLightbox"],"mappings":"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"}